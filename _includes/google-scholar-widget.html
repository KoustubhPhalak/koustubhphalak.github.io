<div class="scholar-widget">
    <h3>ðŸ“š Google Scholar Profile</h3>
    <div class="scholar-stats">
      <div class="stat">
        <span class="number" id="citations">Loading...</span>
        <span class="label">Citations</span>
      </div>
      <div class="stat">
        <span class="number" id="h-index">Loading...</span>
        <span class="label">h-index</span>
      </div>
      <div class="stat">
        <span class="number" id="i10-index">Loading...</span>
        <span class="label">i10-index</span>
      </div>
    </div>
    <a href="https://scholar.google.com/citations?user={{ include.scholar_id }}" target="_blank">
      View Full Profile â†’
    </a>
  </div>
  
  <script>
    window.addEventListener('load', function() {
      console.log('Page loaded, fetching Scholar data...');
      
      var scholarId = '{{ include.scholar_id }}';
      console.log('Scholar ID: ' + scholarId);
      
      var proxies = [
        'https://cors-anywhere.herokuapp.com/',
        'https://api.codetabs.com/v1/proxy?quest=',
        'https://thingproxy.freeboard.io/fetch/',
        'https://cors-proxy.htmldriven.com/?url='
      ];
      
      var targetUrl = 'https://scholar.google.com/citations?user=' + scholarId + '&hl=en';
      var currentProxy = 0;
      
      function tryNextProxy() {
        if (currentProxy >= proxies.length) {
          console.log('All proxies failed');
          showError();
          return;
        }
        
        var proxyUrl = proxies[currentProxy] + encodeURIComponent(targetUrl);
        console.log('Trying proxy ' + (currentProxy + 1) + ': ' + proxies[currentProxy]);
        
        fetch(proxyUrl)
          .then(function(response) {
            if (!response.ok) {
              throw new Error('Response not ok');
            }
            return response.text();
          })
          .then(function(html) {
            console.log('Data received from proxy ' + (currentProxy + 1));
            parseData(html);
          })
          .catch(function(error) {
            console.log('Proxy ' + (currentProxy + 1) + ' failed:', error);
            currentProxy++;
            tryNextProxy();
          });
      }
      
      function parseData(html) {
        try {
          var parser = new DOMParser();
          var doc = parser.parseFromString(html, 'text/html');
          
          var stats = doc.querySelectorAll('.gsc_rsb_std');
          console.log('Found ' + stats.length + ' stat elements');
          
          if (stats.length >= 3) {
            document.getElementById('citations').textContent = stats[0].textContent;
            document.getElementById('h-index').textContent = stats[2].textContent;
            if (stats[4]) {
              document.getElementById('i10-index').textContent = stats[4].textContent;
            }
          } else {
            showError();
          }
        } catch (error) {
          console.error('Parse error:', error);
          showError();
        }
      }
      
      function showError() {
        document.getElementById('citations').textContent = 'Error';
        document.getElementById('h-index').textContent = 'Error';
        document.getElementById('i10-index').textContent = 'Error';
      }
      
      tryNextProxy();
    });
    </script>
  
  <style>
  .scholar-widget {
    background: #f9f9f9;
    border: 1px solid #ddd;
    border-radius: 8px;
    padding: 20px;
    margin: 20px 0;
  }
  
  .scholar-widget h3 {
    margin-top: 0;
    text-align: center;
    color: #333;
  }
  
  .scholar-stats {
    display: flex;
    justify-content: space-around;
    margin: 20px 0;
  }
  
  .stat {
    text-align: center;
  }
  
  .number {
    display: block;
    font-size: 24px;
    font-weight: bold;
    color: #4285f4;
  }
  
  .label {
    font-size: 14px;
    color: #666;
  }
  
  .scholar-widget a {
    display: block;
    text-align: center;
    margin-top: 15px;
    padding: 10px;
    background: #4285f4;
    color: white;
    text-decoration: none;
    border-radius: 5px;
  }
  
  .scholar-widget a:hover {
    background: #3367d6;
  }
  </style>